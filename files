# ConfigMap MUST be in kserve namespace
apiVersion: v1
kind: ConfigMap
metadata:
  name: s3-certs
  namespace: kserve  # Must be kserve namespace
data:
  ca-cert.pem: |
    -----BEGIN CERTIFICATE-----
    # Your certificate content here
    -----END CERTIFICATE-----
---
apiVersion: serving.kserve.io/v1alpha1
kind: ClusterStorageContainer
metadata:
  name: s3-with-cert
spec:
  container:
    name: storage-initializer
    image: kserve/storage-initializer:latest
    env:
      - name: SSL_CERT_FILE
        value: /etc/ssl/certs/ca-cert.pem
      - name: AWS_CA_BUNDLE
        value: /etc/ssl/certs/ca-cert.pem
    volumeMounts:
      - name: ca-cert
        mountPath: /etc/ssl/certs/ca-cert.pem
        subPath: ca-cert.pem
    resources:
      requests:
        memory: 100Mi
        cpu: 100m
      limits:
        memory: 1Gi
        cpu: "1"
  volumes:
    - name: ca-cert
      configMap:
        name: s3-certs
  supportedUriFormats:
    - prefix: s3://
