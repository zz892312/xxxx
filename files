FROM kserve/storage-initializer:latest

# Switch to root to install certificates
USER root

# Copy your certificate
COPY ca-cert.pem /usr/local/share/ca-certificates/ca-cert.crt

# Update CA certificates and fix permissions
RUN update-ca-certificates && \
    chmod 644 /usr/local/share/ca-certificates/ca-cert.crt

# Set SSL environment variables
ENV SSL_CERT_FILE=/etc/ssl/certs/ca-certificates.crt
ENV AWS_CA_BUNDLE=/etc/ssl/certs/ca-certificates.crt

# Switch back to the non-root user (kserve uses uid 65532)
USER 65532
